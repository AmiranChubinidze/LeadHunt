<!DOCTYPE html>
<html lang="en" class="h-full">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>LeadHunt</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet" />
    <style>
      :root {
        --bg: #0a0a0c;
        --surface: #121215;
        --surface-2: #0f0f12;
        --text-primary: #f2f2f5;
        --text-secondary: #b7b7c4;
        --accent: #f3b0b0;
        --accent-strong: #e98282;
        --accent-dark: #c96b6b;
        --border: rgba(255, 255, 255, 0.08);
        --shadow: rgba(0, 0, 0, 0.55);
      }
      html,
      body {
        font-family: "Inter", sans-serif;
        background: var(--bg);
        color: var(--text-primary);
      }
      .text-text-secondary {
        color: var(--text-secondary);
      }
      .text-text-primary {
        color: var(--text-primary);
      }
      .text-accent {
        color: var(--accent);
      }
      .bg-surface {
        background: var(--surface);
      }
      .bg-surface-2 {
        background: var(--surface-2);
      }
      .border-hairline {
        border: 1px solid var(--border);
      }
      .glow-bg {
        background-image:
          radial-gradient(700px 420px at -10% -10%, rgba(243, 176, 176, 0.18), transparent 62%),
          radial-gradient(700px 420px at 110% 0%, rgba(233, 130, 130, 0.12), transparent 60%),
          radial-gradient(700px 480px at 90% 110%, rgba(201, 107, 107, 0.12), transparent 60%),
          linear-gradient(135deg, rgba(50, 10, 12, 0.35), rgba(10, 10, 12, 0.9) 50%, rgba(10, 10, 12, 0.98));
      }
      .noise::before {
        content: "";
        position: absolute;
        inset: 0;
        background-image: repeating-linear-gradient(
          0deg,
          rgba(255, 255, 255, 0.02),
          rgba(255, 255, 255, 0.02) 1px,
          transparent 1px,
          transparent 2px
        );
        opacity: 0.15;
        pointer-events: none;
      }
      .card {
        border-radius: 20px;
        background: linear-gradient(180deg, rgba(255, 255, 255, 0.03), rgba(255, 255, 255, 0)) , var(--surface);
        border: 1px solid var(--border);
        box-shadow: 0 16px 40px -24px var(--shadow);
        position: relative;
        overflow: hidden;
      }
      .card::after {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 1px;
        background: rgba(255, 255, 255, 0.08);
      }
      .input {
        background: #17171b;
        border: 1px solid rgba(255, 255, 255, 0.08);
        border-radius: 14px;
        padding: 0.9rem 1rem;
        height: 52px;
        color: var(--text-primary);
      }
      .input:focus {
        outline: none;
        border-color: rgba(243, 176, 176, 0.6);
        box-shadow: 0 0 0 3px rgba(243, 176, 176, 0.15);
      }
      .select-wrap {
        position: relative;
      }
      .select-wrap::after {
        content: "";
        position: absolute;
        right: 18px;
        top: 50%;
        transform: translateY(-50%) rotate(45deg);
        width: 10px;
        height: 10px;
        border-right: 2px solid rgba(243, 176, 176, 0.7);
        border-bottom: 2px solid rgba(243, 176, 176, 0.7);
        pointer-events: none;
      }
      select.input {
        -webkit-appearance: none;
        -moz-appearance: none;
        appearance: none;
        padding-right: 2.5rem;
        background-image: linear-gradient(180deg, rgba(255, 255, 255, 0.02), rgba(255, 255, 255, 0));
      }
      .btn-primary {
        border-radius: 999px;
        background: linear-gradient(180deg, rgba(243, 176, 176, 0.95), rgba(233, 130, 130, 0.95));
        color: #1a1111;
        font-weight: 600;
        padding: 0.85rem 1.25rem;
        box-shadow: 0 10px 24px -16px rgba(243, 176, 176, 0.7);
        transition: transform 0.15s ease, box-shadow 0.15s ease, filter 0.15s ease;
      }
      .btn-primary:hover {
        transform: translateY(-1px);
        box-shadow: 0 14px 30px -18px rgba(243, 176, 176, 0.9);
        filter: brightness(1.03);
      }
      .btn-primary:active {
        transform: translateY(0);
        box-shadow: 0 8px 18px -14px rgba(243, 176, 176, 0.6);
      }
      .btn-outline {
        border-radius: 999px;
        border: 1px solid rgba(255, 255, 255, 0.14);
        color: var(--text-secondary);
        padding: 0.7rem 1.25rem;
        transition: border-color 0.15s ease, color 0.15s ease, transform 0.15s ease;
      }
      .btn-outline:hover {
        color: var(--text-primary);
        border-color: rgba(255, 255, 255, 0.3);
        transform: translateY(-1px);
      }
    </style>
  </head>
  <body class="min-h-full glow-bg">
    <div class="relative min-h-full noise">
      <div class="max-w-xl mx-auto px-5 sm:px-8 py-12 space-y-12">
        <header class="space-y-4 text-center">
          <div class="inline-flex items-center gap-2 rounded-full border border-white/10 bg-white/5 px-3 py-1 text-sm text-text-secondary">
            <span class="h-2 w-2 rounded-full" style="background: var(--accent)"></span>
            Instagram Influencer Search
          </div>
          <h1 class="text-4xl font-semibold tracking-tight">LeadHunt</h1>
          <p class="text-base font-normal text-text-secondary">
            Calm, precise hashtag-based discovery for small batches of creators.
          </p>
        </header>

        <section id="connect-screen" class="max-w-lg mx-auto mt-16">
          <div class="card p-10 space-y-8">
            <h2 class="text-3xl font-semibold text-center">Connect Instagram</h2>
            <form id="connect-form" class="space-y-6">
              <div>
                <label class="text-sm font-medium text-text-secondary block mb-2">Instagram Username</label>
                <input
                  id="ig-username"
                  type="text"
                  placeholder="@yourhandle"
                  class="w-full input"
                />
              </div>
              <div>
                <label class="text-sm font-medium text-text-secondary block mb-2">Instagram Password</label>
                <input
                  id="ig-password"
                  type="password"
                  placeholder="��������"
                  class="w-full input"
                />
              </div>
              <button type="submit" class="w-full btn-primary">
                Connect Account
              </button>
            </form>
            <div id="connect-status" class="text-sm font-medium text-text-secondary text-center"></div>
          </div>
        </section>

        <section id="dashboard" class="hidden space-y-10">
          <div class="card p-8 space-y-6">
            <div class="flex items-center justify-between">
              <div>
                <h2 class="text-xl font-semibold">Search</h2>
                <p class="text-sm text-text-secondary">Hashtag-based search with clean filters.</p>
              </div>
              <button id="disconnect-btn" class="btn-outline">
                Disconnect
              </button>
            </div>

            <form id="search-form" class="space-y-8">
              <div class="space-y-6">
                <div>
                  <label class="text-sm font-medium text-text-secondary block mb-2">Niche</label>
                  <div class="select-wrap">
                    <select id="niche" class="w-full input">
                      <option value="fitness">Fitness</option>
                      <option value="beauty">Beauty</option>
                      <option value="travel">Travel</option>
                      <option value="food">Food</option>
                      <option value="custom">Custom</option>
                    </select>
                  </div>
                </div>

                <div id="custom-tags" class="grid grid-cols-1 sm:grid-cols-3 gap-4 hidden">
                  <div>
                    <label class="text-sm font-medium text-text-secondary block mb-2">Hashtag 1</label>
                    <input id="tag-1" type="text" placeholder="fitness" class="w-full input" />
                  </div>
                  <div>
                    <label class="text-sm font-medium text-text-secondary block mb-2">Hashtag 2</label>
                    <input id="tag-2" type="text" placeholder="workout" class="w-full input" />
                  </div>
                  <div>
                    <label class="text-sm font-medium text-text-secondary block mb-2">Hashtag 3</label>
                    <input id="tag-3" type="text" placeholder="gym" class="w-full input" />
                  </div>
                </div>

                <div class="grid grid-cols-1 sm:grid-cols-3 gap-4">
                  <div>
                    <label class="text-sm font-medium text-text-secondary block mb-2">Min Followers</label>
                    <input id="min-f" type="number" value="1000" class="w-full input" />
                  </div>
                  <div>
                    <label class="text-sm font-medium text-text-secondary block mb-2">Max Followers</label>
                    <input id="max-f" type="number" value="50000" class="w-full input" />
                  </div>
                  <div>
                    <label class="text-sm font-medium text-text-secondary block mb-2">Min Engagement</label>
                    <input id="min-e" type="number" step="0.01" value="0.02" class="w-full input" />
                  </div>
                </div>
              </div>

              <button type="submit" class="w-full btn-primary">
                Search
              </button>
            </form>

            <div id="search-status" class="text-sm font-medium text-text-secondary"></div>
          </div>

          <div class="card p-8 space-y-6">
            <h3 class="text-xl font-semibold">Results</h3>
            <div class="overflow-x-auto">
              <table class="w-full text-left">
                <thead class="border-b border-white/10 text-text-secondary text-sm font-medium">
                  <tr>
                    <th class="py-3">Username</th>
                    <th class="py-3">Followers</th>
                    <th class="py-3">Engagement</th>
                  </tr>
                </thead>
                <tbody id="results-body" class="text-base">
                  <tr class="border-b border-white/5 last:border-none">
                    <td class="py-6 text-text-secondary text-center" colspan="3">No results yet</td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </section>
      </div>
    </div>

    <script>
      const connectScreen = document.getElementById("connect-screen");
      const dashboard = document.getElementById("dashboard");
      const connectForm = document.getElementById("connect-form");
      const searchForm = document.getElementById("search-form");
      const connectStatus = document.getElementById("connect-status");
      const searchStatus = document.getElementById("search-status");
      const resultsBody = document.getElementById("results-body");
      const disconnectBtn = document.getElementById("disconnect-btn");
      const nicheSelect = document.getElementById("niche");
      const customTags = document.getElementById("custom-tags");

      function showDashboard() {
        connectScreen.classList.add("hidden");
        dashboard.classList.remove("hidden");
      }

      function showConnect() {
        dashboard.classList.add("hidden");
        connectScreen.classList.remove("hidden");
      }

      function setConnected(value) {
        localStorage.setItem("connected", value ? "1" : "0");
      }

      if (localStorage.getItem("connected") === "1") {
        showDashboard();
      }

      nicheSelect.addEventListener("change", () => {
        if (nicheSelect.value === "custom") {
          customTags.classList.remove("hidden");
        } else {
          customTags.classList.add("hidden");
        }
      });

      connectForm.addEventListener("submit", async (e) => {
        e.preventDefault();
        connectStatus.textContent = "Connecting...";
        connectStatus.className = "text-sm font-medium text-text-secondary text-center";

        const ig_username = document.getElementById("ig-username").value.trim();
        const ig_password = document.getElementById("ig-password").value;

        try {
          const res = await fetch("/connect-ig", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ ig_username, ig_password }),
          });
          const data = await res.json();
          if (!res.ok) {
            connectStatus.textContent = data.detail || "Connection failed";
            connectStatus.className = "text-sm font-medium text-accent text-center";
            return;
          }
          connectStatus.textContent = "Connected";
          connectStatus.className = "text-sm font-medium text-accent text-center";
          setConnected(true);
          localStorage.setItem("ig_username", ig_username);
          showDashboard();
        } catch (err) {
          connectStatus.textContent = "Network error";
          connectStatus.className = "text-sm font-medium text-accent text-center";
        }
      });

      disconnectBtn.addEventListener("click", () => {
        setConnected(false);
        localStorage.removeItem("ig_username");
        showConnect();
      });

      function renderResults(results) {
        resultsBody.innerHTML = "";
        if (!results.length) {
          resultsBody.innerHTML = `
            <tr class="border-b border-white/5 last:border-none">
              <td class="py-6 text-text-secondary text-center" colspan="3">No results</td>
            </tr>
          `;
          return;
        }
        for (const r of results) {
          const row = document.createElement("tr");
          row.className = "border-b border-white/5 last:border-none hover:bg-white/5";
          row.innerHTML = `
            <td class="py-4"><a class="text-accent hover:underline" href="https://instagram.com/${r.ig_username}" target="_blank">@${r.ig_username}</a></td>
            <td class="py-4">${r.follower_count}</td>
            <td class="py-4">${(r.engagement_rate * 100).toFixed(2)}%</td>
          `;
          resultsBody.appendChild(row);
        }
      }

      searchForm.addEventListener("submit", async (e) => {
        e.preventDefault();
        searchStatus.textContent = "Searching...";
        searchStatus.className = "text-sm font-medium text-text-secondary";

        const niche = document.getElementById("niche").value;
        const min_f = document.getElementById("min-f").value;
        const max_f = document.getElementById("max-f").value;
        const min_e = document.getElementById("min-e").value;
        const ig_username = localStorage.getItem("ig_username") || "";

        const params = new URLSearchParams({ niche, min_f, max_f, min_e });
        if (ig_username) {
          params.set("ig_username", ig_username);
        }
        if (niche === "custom") {
          const tag1 = document.getElementById("tag-1").value.trim();
          const tag2 = document.getElementById("tag-2").value.trim();
          const tag3 = document.getElementById("tag-3").value.trim();
          params.set("tags", [tag1, tag2, tag3].filter(Boolean).join(","));
        }

        try {
          const res = await fetch(`/search?${params.toString()}`);
          const data = await res.json();
          if (!res.ok) {
            searchStatus.textContent = data.detail || "Search failed";
            searchStatus.className = "text-sm font-medium text-accent";
            return;
          }
          searchStatus.textContent = "Done";
          searchStatus.className = "text-sm font-medium text-accent";
          renderResults(data.results || []);
        } catch (err) {
          searchStatus.textContent = "Network error";
          searchStatus.className = "text-sm font-medium text-accent";
        }
      });
    </script>
  </body>
</html>